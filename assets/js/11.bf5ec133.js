(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{149:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"代理模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理模式","aria-hidden":"true"}},[t._v("#")]),t._v(" 代理模式")]),t._v(" "),a("h2",{attrs:{id:"一、定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、定义","aria-hidden":"true"}},[t._v("#")]),t._v(" 一、定义")]),t._v(" "),a("p",[a("strong",[t._v("代理模式")]),t._v("：为一个对象提供一个"),a("strong",[t._v("代用品")]),t._v("或"),a("strong",[t._v("占位符")]),t._v("，以便控制对它的访问。代理模式的"),a("strong",[t._v("关键")]),t._v("是，当客户不方便直接访问一个对象或者不满足需要的时候，为其提供一个替身对象来控制对这个对象的访问。"),a("br"),t._v("\n  而实际上，客户访问的是替身对象。替身对象对请求作出一些处理之后，再把请求转交给本体对象。")]),t._v(" "),a("h3",{attrs:{id:"_1-1-保护代理和虚拟代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-保护代理和虚拟代理","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.1 保护代理和虚拟代理")]),t._v(" "),a("p",[t._v("  以送花为例，代理"),a("code",[t._v("B")]),t._v("可以帮助对象"),a("code",[t._v("A")]),t._v("过滤掉一些请求，比如送花的人中年龄太大或者没有车，这种请求就可以直接在代理"),a("code",[t._v("B")]),t._v("处被拒绝---这种代理形式就叫"),a("code",[t._v("保护代理")]),t._v("。"),a("br"),t._v("\n  另外，假设现实中花的价格不菲，导致在程序世界里，"),a("code",[t._v("new Flower")]),t._v("也是一个代价昂贵的操作，那么我们可以把"),a("code",[t._v("new Flower")]),t._v("的操作交给代理"),a("code",[t._v("B")]),t._v("去执行，代理"),a("code",[t._v("B")]),t._v("会选择在"),a("code",[t._v("A")]),t._v("心情好时再执行"),a("code",[t._v("new Flower")]),t._v("---这种代理形式就叫"),a("code",[t._v("虚拟代理")]),t._v("。虚拟代理可以把一些开销很大的对象，"),a("strong",[t._v("延迟")]),t._v("到真正需要它的时候才去创建。代码如下：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("B")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("receiveFlower")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("flower")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listenGoodMood")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" flower "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Flower")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//监听A的好心情")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("receiveFlower")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" flower "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//延迟创建flower对象")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("  保护代理用于控制不同"),a("strong",[t._v("权限的对象")]),t._v("对目标对象的访问，但在"),a("code",[t._v("JavaScript")]),t._v("并不容易实现保护代理，因为我们"),a("strong",[t._v("无法判断谁访问了目标对象")]),t._v("。而虚拟代理是最常用的一种代理模式，本章亦主要讨论虚拟代理。")]),t._v(" "),a("h2",{attrs:{id:"二、虚拟代理实现图片预加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、虚拟代理实现图片预加载","aria-hidden":"true"}},[t._v("#")]),t._v(" 二、虚拟代理实现图片预加载")]),t._v(" "),a("p",[t._v("  在"),a("code",[t._v("Web")]),t._v("开发中，图片预加载是一种常用的技术，如果直接给某个"),a("code",[t._v("img")]),t._v("标签节点设置"),a("code",[t._v("src")]),t._v("属性，由于某些图片过大或者网络不佳，图片的位置往往有段时间会是"),a("strong",[t._v("一片空白")]),t._v("。常见的做法是先用一张"),a("code",[t._v("loading")]),t._v("图片站位，然后用"),a("code",[t._v("异步")]),t._v("的方式加载图片，等图片加载好了再把它填充到"),a("code",[t._v("img")]),t._v("节点里，这种场景就很适合使用虚拟代理。"),a("br"),t._v("\n  首先创建一个普通的本体对象，这个对象负责往页面中创建一个"),a("code",[t._v("img")]),t._v("标签，并且提供一个对外的"),a("code",[t._v("setSrc")]),t._v("接口，外界调用这个接口，便可以给该"),a("code",[t._v("img")]),t._v("标签设置"),a("code",[t._v("src")]),t._v("属性：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" myImage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" imgNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'img'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("imgNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("setSrc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           \timgNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tmyImage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSrc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://i3.sinaimg.cn/gm/o/i/2008-09-03/U1901P115T41D148033F757DT20080903105357.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("  如果将网速调至"),a("code",[t._v("slow 3G")]),t._v("，可以看到在图片被加载好之前，页面中有一段长长的空白时间。现在我们引入带来对象"),a("code",[t._v("proxyImage")]),t._v("，通过这个代理对象，在图片被真正加载好之前，页面中将会出现一张展位图"),a("code",[t._v("loading.gif")]),t._v("来提示用户正在加载：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" proxyImage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//图片加载完后执行")]),t._v("\n        img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            myImage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSrc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("setSrc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    myImage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSrc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./loading.gif'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tproxyImage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSrc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("  现在我们通过"),a("code",[t._v("proxyImage")]),t._v("间接地访问"),a("code",[t._v("MyImage")]),t._v("。前者控制了客户对"),a("code",[t._v("MyImage")]),t._v("的访问，且在此过程中加入一些额外的操作。")]),t._v(" "),a("h2",{attrs:{id:"三、代理的意义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、代理的意义","aria-hidden":"true"}},[t._v("#")]),t._v(" 三、代理的意义")]),t._v(" "),a("p",[t._v("  为了说明代理的意义，下面我们引入一个面向对象设计的原则--单一职责原则。"),a("br"),t._v(" "),a("strong",[t._v("单一职责")]),t._v("原则指的是，一个类应该仅有"),a("strong",[t._v("一个")]),t._v("引起它变化的原因。如果一个对象承担了多项职责，就意味着该对象将变得巨大，引起它的原因可能会有多个。"),a("br"),t._v("\n  如果一个对象承担的职责过多，就相当于将这些职责"),a("strong",[t._v("耦合")]),t._v("到了一起，这种耦合会导致脆弱和低内聚的设计。"),a("br"),t._v("\n  如果不使用代理模式，我们需要"),a("code",[t._v("MyImage")]),t._v("对象除了给"),a("code",[t._v("img")]),t._v("节点设置"),a("code",[t._v("src")]),t._v("外，还要负责预加载图片。我们在处理其中一个职责时，有可能因为其强耦合性影响另一个职责的实现。"),a("br"),t._v("\n  另外，在面向对象的程序设计中，大多数情况下，若违反其他任何原则，同时将违反"),a("strong",[t._v("开放-封闭")]),t._v("原则。如果我们只是从网上获取一些体积很小的图片，那就可能希望将预加载从"),a("code",[t._v("MyImage")]),t._v("对象里删掉，而这时候就不得不改动"),a("code",[t._v("MyImage")]),t._v("对象了。如果能把这个预加载操作放在另一个对象中，自然是一个很好的方法。于是代理的作用在这里就体现出来了 ，代理负载加载图片，预加载完成后，将请求重新交给本体对象。")])])},[],!1,null,null,null);s.default=e.exports}}]);