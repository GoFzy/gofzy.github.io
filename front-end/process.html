<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器的多进程机制 | GoFzy</title>
    <meta name="description" content="脚踏实地，仰望星空">
    <link rel="icon" href="/F.png">
    
    <link rel="preload" href="/assets/css/0.styles.1b9f5e10.css" as="style"><link rel="preload" href="/assets/js/app.e2a0bc12.js" as="script"><link rel="preload" href="/assets/js/2.ffc85a67.js" as="script"><link rel="preload" href="/assets/js/9.32855513.js" as="script"><link rel="prefetch" href="/assets/js/10.16eab02a.js"><link rel="prefetch" href="/assets/js/11.bf5ec133.js"><link rel="prefetch" href="/assets/js/12.221b6f67.js"><link rel="prefetch" href="/assets/js/13.c6e69e20.js"><link rel="prefetch" href="/assets/js/14.99a9d455.js"><link rel="prefetch" href="/assets/js/15.3a284737.js"><link rel="prefetch" href="/assets/js/16.79d64dc1.js"><link rel="prefetch" href="/assets/js/17.5e406ce6.js"><link rel="prefetch" href="/assets/js/18.b72926f6.js"><link rel="prefetch" href="/assets/js/19.61fc4542.js"><link rel="prefetch" href="/assets/js/20.3db0d9bc.js"><link rel="prefetch" href="/assets/js/21.f4c1528d.js"><link rel="prefetch" href="/assets/js/22.3a481cb5.js"><link rel="prefetch" href="/assets/js/23.cdee567e.js"><link rel="prefetch" href="/assets/js/24.856be0b9.js"><link rel="prefetch" href="/assets/js/25.df567523.js"><link rel="prefetch" href="/assets/js/26.08fc6653.js"><link rel="prefetch" href="/assets/js/27.1b4e7bc2.js"><link rel="prefetch" href="/assets/js/28.a8b8135e.js"><link rel="prefetch" href="/assets/js/29.7b17ab5a.js"><link rel="prefetch" href="/assets/js/3.dc5d0d43.js"><link rel="prefetch" href="/assets/js/30.dd840729.js"><link rel="prefetch" href="/assets/js/31.3f22bf3e.js"><link rel="prefetch" href="/assets/js/32.998c6ce0.js"><link rel="prefetch" href="/assets/js/33.75bd15bf.js"><link rel="prefetch" href="/assets/js/34.bcb04044.js"><link rel="prefetch" href="/assets/js/35.2494bca3.js"><link rel="prefetch" href="/assets/js/36.cd36c95a.js"><link rel="prefetch" href="/assets/js/37.f13bf26a.js"><link rel="prefetch" href="/assets/js/38.b19352c9.js"><link rel="prefetch" href="/assets/js/39.3c848e8d.js"><link rel="prefetch" href="/assets/js/4.c516a99f.js"><link rel="prefetch" href="/assets/js/40.4ead735b.js"><link rel="prefetch" href="/assets/js/41.dde15470.js"><link rel="prefetch" href="/assets/js/5.28430339.js"><link rel="prefetch" href="/assets/js/6.206f7f91.js"><link rel="prefetch" href="/assets/js/7.f065ebd0.js"><link rel="prefetch" href="/assets/js/8.6c06ae76.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1b9f5e10.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">GoFzy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link router-link-active">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link router-link-active">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/front-end/" class="sidebar-link">前端知识体系梳理</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-end/process.html" class="active sidebar-link">1. 浏览器的多进程机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end/process.html#进程与线程的概念" class="sidebar-link">进程与线程的概念</a></li><li class="sidebar-sub-header"><a href="/front-end/process.html#浏览器中常见的进程" class="sidebar-link">浏览器中常见的进程</a></li><li class="sidebar-sub-header"><a href="/front-end/process.html#浏览器的渲染进程" class="sidebar-link">浏览器的渲染进程</a></li><li class="sidebar-sub-header"><a href="/front-end/process.html#gui渲染线程工作流程" class="sidebar-link">GUI渲染线程工作流程</a></li><li class="sidebar-sub-header"><a href="/front-end/process.html#js引擎线程解析流程" class="sidebar-link">JS引擎线程解析流程</a></li></ul></li><li><a href="/front-end/http.html" class="sidebar-link">2. http协议</a></li><li><a href="/front-end/" class="sidebar-link">返回上一级</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器的多进程机制"><a href="#浏览器的多进程机制" aria-hidden="true" class="header-anchor">#</a> 浏览器的多进程机制</h1> <h2 id="进程与线程的概念"><a href="#进程与线程的概念" aria-hidden="true" class="header-anchor">#</a> 进程与线程的概念</h2> <ul><li>进程: <code>CPU</code>资源分配的最小单位</li> <li>线程: <code>CPU</code>调度的最小单位</li></ul> <h2 id="浏览器中常见的进程"><a href="#浏览器中常见的进程" aria-hidden="true" class="header-anchor">#</a> 浏览器中常见的进程</h2> <p>浏览器是多进程的，常见的进程如下:</p> <ol><li><strong>主控</strong>进程，只有一个，负责调度，管理整个浏览器的运行</li> <li><strong>渲染</strong>进程，也称<strong>浏览器内核</strong>，每一个 <code>tab</code> 页一个，负责页面渲染，<code>js</code> 执行等</li> <li><strong>第三方插件</strong>进程，浏览器开启的第三方插件</li> <li><code>GPU</code>进程，只有一个，用于 <code>3D</code> 绘制</li></ol> <h2 id="浏览器的渲染进程"><a href="#浏览器的渲染进程" aria-hidden="true" class="header-anchor">#</a> 浏览器的渲染进程</h2> <p>浏览器渲染进程也称浏览器内核，在这个进程内会进行页面的渲染、<code>JS</code> 的执行以及事件循环，因此浏览器渲染进程又是<strong>多线程</strong>的，具体包括如下线程:<br> <img src="https://raw.githubusercontent.com/GoFzy/pic-bed/master/browser_inner_thread.png" alt="browser_inner_thread"><br></p><h4>GUI渲染线程</h4><p></p> <ul><li>负责渲染浏览器界面，解析<code>HTML</code>，<code>CSS</code>，构建 <code>DOM</code> 树、<code>CSS</code>规则树并生成 <code>Render</code> 树，最后进行布局和绘制等。</li> <li>当界面需要重绘（<code>Repaint</code>）或由于某种操作引发回流( <code>Reflow</code> )时，该线程就会执行</li> <li>注意，<code>GUI</code> 渲染线程与 <code>JS</code> 引擎线程是互斥的</li></ul> <h4>JS引擎线程</h4> <ul><li>也称为JS内核，负责处理 <code>JS</code> 脚本程序（例如V8引擎），一个 <code>tab</code> 页只有一个该线程用来执行<code>JS</code>（单线程）</li> <li>同样注意，GUI渲染线程与JS引擎线程是互斥的，所以如果JS执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞</li></ul> <h4>事件触发线程</h4> <ul><li>归属于浏览器而不是JS引擎，用来控制事件循环</li> <li>当 <code>JS</code> 引擎执行代码块如定时器、<code>AJAX</code> 请求时，会在相应线程处理完成后将对应回调任务添加到事件线程中</li> <li>当 <code>JS</code> 引擎空闲时，该线程会把事件添加到待处理队列的队尾，让 <code>JS</code> 引擎的处理</li> <li>注意，由于 <code>JS</code> 的<strong>单线程</strong>关系，所以这些待处理队列中的事件都得排队等待 <code>JS</code> 引擎处理（当<code>JS</code> 引擎空闲时才会去执行）</li></ul> <h4>定时触发器线程</h4> <ul><li>传说中的 <code>setInterval</code> 与 <code>setTimeout</code> 所在线程</li> <li>浏览器定时计数器并不是由 <code>JS</code> 引擎计数的,（因为 <code>JS</code> 引擎是单线程的, 如果处于阻塞线程状态就会影响记计时的准确）</li> <li>通过单独线程来计时并触发定时（计时完毕后，添加到事件队列中，等待 <code>JS</code> 引擎空闲后执行）</li></ul> <h4>异步http请求线程</h4> <ul><li>在<code>XMLHttpReques</code>t在连接后是通过浏览器新开一个线程请求，具体来说就是在 <code>send</code> 方法调用后开启</li> <li>将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调再放入事件队列中，再由 <code>JS</code> 引擎执行</li></ul> <h2 id="gui渲染线程工作流程"><a href="#gui渲染线程工作流程" aria-hidden="true" class="header-anchor">#</a> GUI渲染线程工作流程</h2> <p>浏览器器内核拿到内容后，渲染大概可以划分成以下几个步骤：</p> <ul><li>解析 <code>HTML</code> 生成 <code>DOM</code> 树</li> <li>解析 <code>CSS</code> 生成 <code>CSS</code> 规则树</li> <li>将 <code>CSS</code> 规则树与 <code>DOM</code> 树合并成 <code>Render</code> 树</li> <li>布局<code>Render</code> 树（<code>Layout/reflow</code>），负责各元素尺寸、位置的计算</li> <li>绘制 <code>Render</code> 树（<code>paint</code>），绘制页面像素信息，并显示在屏幕上</li></ul> <p>渲染完毕后就是<code>window.onload</code> 事件了，之后就是自己的 <code>JS</code> 逻辑处理了，具体流程可以参考下图进行理解
<img src="https://raw.githubusercontent.com/GoFzy/pic-bed/master/browser_rending.png" alt="browser_rending"></p> <h2 id="js引擎线程解析流程"><a href="#js引擎线程解析流程" aria-hidden="true" class="header-anchor">#</a> JS引擎线程解析流程</h2> <h3>预处理阶段</h3> <p>首先在 <code>js</code> 解析执行前，会有一个<strong>预处理</strong>阶段，这里仅提部分内容:</p> <p><strong>1. 分号补全</strong></p> <ul><li>当有换行符（包括含有换行符的多行注释），并且下一个 <code>token</code> 没法跟前面的语法匹配时，会自动补分号</li> <li>当有}时，如果缺少分号，会补分号</li> <li>程序源代码结束时，如果缺少分号，会补分号</li></ul> <p>例如</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>
  <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token string">'a'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由于分号补全机制，所以它变成了：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
        a<span class="token punctuation">:</span> <span class="token string">'a'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所以运行后是<code>undefined</code></p> <p><strong>2. 变量提升</strong><br>
一般包括<strong>函数提升</strong>和<strong>变量提升</strong>，这里不展开只说结论，详情可以参看<a href="https://juejin.im/post/5a0e3577f265da43085d978b" target="_blank" rel="noopener noreferrer">该篇文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li><strong>使用 <code>var</code> 定义变量的时候，<code>js</code> 解释器会将变量提升到该作用域的最顶部，这就是变量提升</strong></li> <li><strong>函数的提升只对声明式函数有效，对字面量函数无效，且函数会被优先放在顶部，而后才是变量</strong></li></ul> <h3>解析阶段</h3> <p>在解析阶段，V8引擎分为以下几个模块对源码进行处理:</p> <ul><li><code>Parser</code>：通过分词和语法分析将 <code>JS</code> 源码转换成 <code>AST(Abstract Syntax Tree)</code> 语法树(<code>babel</code>就是通过替换 <code>AST</code> 语法树实现 <code>ES6</code> 到 <code>ES5</code> 的转换)</li> <li><code>Ignition</code>：解释器，负责将 <code>AST</code> 语法树解释成 <code>bytecode</code> 字节码</li> <li><code>Turbofan</code>： 编译器，负责将 <code>bytecode</code> 字节码转换成汇编代码</li></ul> <p>除此以外，V8引擎中还有个 <code>Orinoca</code> <strong>垃圾回收模块</strong>，清除方法分为以下两种：</p> <ul><li>标记清除: 遍历所有可访问的对象，回收已不可访问的对象</li> <li>引用次数：跟踪记录每个值被引用的次数，回收次数为0的对象</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于：: </span> <span class="time">9/7/2019, 4:40:26 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/front-end/" class="prev router-link-active">
          前端知识体系梳理
        </a></span> <span class="next"><a href="/front-end/http.html">
          2. http协议
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2a0bc12.js" defer></script><script src="/assets/js/2.ffc85a67.js" defer></script><script src="/assets/js/9.32855513.js" defer></script>
  </body>
</html>
