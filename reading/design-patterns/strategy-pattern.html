<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>策略模式 | GoFzy</title>
    <meta name="description" content="脚踏实地，仰望星空">
    <link rel="icon" href="/F.png">
    
    <link rel="preload" href="/assets/css/0.styles.1b9f5e10.css" as="style"><link rel="preload" href="/assets/js/app.e2a0bc12.js" as="script"><link rel="preload" href="/assets/js/2.ffc85a67.js" as="script"><link rel="preload" href="/assets/js/18.b72926f6.js" as="script"><link rel="prefetch" href="/assets/js/10.16eab02a.js"><link rel="prefetch" href="/assets/js/11.bf5ec133.js"><link rel="prefetch" href="/assets/js/12.221b6f67.js"><link rel="prefetch" href="/assets/js/13.c6e69e20.js"><link rel="prefetch" href="/assets/js/14.99a9d455.js"><link rel="prefetch" href="/assets/js/15.3a284737.js"><link rel="prefetch" href="/assets/js/16.79d64dc1.js"><link rel="prefetch" href="/assets/js/17.5e406ce6.js"><link rel="prefetch" href="/assets/js/19.61fc4542.js"><link rel="prefetch" href="/assets/js/20.3db0d9bc.js"><link rel="prefetch" href="/assets/js/21.f4c1528d.js"><link rel="prefetch" href="/assets/js/22.3a481cb5.js"><link rel="prefetch" href="/assets/js/23.cdee567e.js"><link rel="prefetch" href="/assets/js/24.856be0b9.js"><link rel="prefetch" href="/assets/js/25.df567523.js"><link rel="prefetch" href="/assets/js/26.08fc6653.js"><link rel="prefetch" href="/assets/js/27.1b4e7bc2.js"><link rel="prefetch" href="/assets/js/28.a8b8135e.js"><link rel="prefetch" href="/assets/js/29.7b17ab5a.js"><link rel="prefetch" href="/assets/js/3.dc5d0d43.js"><link rel="prefetch" href="/assets/js/30.dd840729.js"><link rel="prefetch" href="/assets/js/31.3f22bf3e.js"><link rel="prefetch" href="/assets/js/32.998c6ce0.js"><link rel="prefetch" href="/assets/js/33.75bd15bf.js"><link rel="prefetch" href="/assets/js/34.bcb04044.js"><link rel="prefetch" href="/assets/js/35.2494bca3.js"><link rel="prefetch" href="/assets/js/36.cd36c95a.js"><link rel="prefetch" href="/assets/js/37.f13bf26a.js"><link rel="prefetch" href="/assets/js/38.b19352c9.js"><link rel="prefetch" href="/assets/js/39.3c848e8d.js"><link rel="prefetch" href="/assets/js/4.c516a99f.js"><link rel="prefetch" href="/assets/js/40.4ead735b.js"><link rel="prefetch" href="/assets/js/41.dde15470.js"><link rel="prefetch" href="/assets/js/5.28430339.js"><link rel="prefetch" href="/assets/js/6.206f7f91.js"><link rel="prefetch" href="/assets/js/7.f065ebd0.js"><link rel="prefetch" href="/assets/js/8.6c06ae76.js"><link rel="prefetch" href="/assets/js/9.32855513.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1b9f5e10.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">GoFzy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link router-link-active">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link router-link-active">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/reading/design-patterns/" class="sidebar-link">JavaScript设计模式与开发实践</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading/design-patterns/prototypical.html" class="sidebar-link">1.原型继承</a></li><li><a href="/reading/design-patterns/about-this.html" class="sidebar-link">2.this、apply和call</a></li><li><a href="/reading/design-patterns/closure.html" class="sidebar-link">3.闭包和高阶函数</a></li><li><a href="/reading/design-patterns/singleton.html" class="sidebar-link">4.单例模式</a></li><li><a href="/reading/design-patterns/strategy-pattern.html" class="active sidebar-link">5.策略模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading/design-patterns/strategy-pattern.html#一、定义及其实现" class="sidebar-link">一、定义及其实现</a></li><li class="sidebar-sub-header"><a href="/reading/design-patterns/strategy-pattern.html#二、更广义的“算法”" class="sidebar-link">二、更广义的“算法”</a></li><li class="sidebar-sub-header"><a href="/reading/design-patterns/strategy-pattern.html#三、策略模式的优缺点" class="sidebar-link">三、策略模式的优缺点</a></li></ul></li><li><a href="/reading/design-patterns/template-method.html" class="sidebar-link">6.模板方法模式</a></li><li><a href="/reading/design-patterns/publish-subscribe.html" class="sidebar-link">7.发布订阅模式</a></li><li><a href="/reading/" class="sidebar-link">返回上一级</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="策略模式"><a href="#策略模式" aria-hidden="true" class="header-anchor">#</a> 策略模式</h1> <h2 id="一、定义及其实现"><a href="#一、定义及其实现" aria-hidden="true" class="header-anchor">#</a> 一、定义及其实现</h2> <p><strong>策略模式</strong>：定义一系列算法，把它们一个个<strong>封装</strong>起来，并且使它们可以互相替换。</p> <h3 id="_1-1-计算奖金-直接实现"><a href="#_1-1-计算奖金-直接实现" aria-hidden="true" class="header-anchor">#</a> 1.1 计算奖金--直接实现</h3> <p>  一般年终奖是根据员工的工资基数×年底绩效来计算，比如绩效为S级的人，他的年终奖有4倍工资；绩效为A级的人，他的年终奖有3倍工资。<br>
  这里直接实现的方式是编写一个<code>calculateBonus</code>函数来计算每个人的奖金，很显然它需要两个参数：员工的基本工资和绩效等级：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token keyword">var</span> <span class="token function-variable function">calculateBonus</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">level<span class="token punctuation">,</span>salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token string">'S'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>leverl <span class="token operator">===</span> <span class="token string">'B'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">calculateBonus</span><span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//24000</span>
</code></pre></div><p>  上述代码十分简单，但存在着显而易见的缺陷：</p> <ul><li><code>calculateBonus</code>函数十分庞大，包含了很多<code>if</code>语句，这些语句要覆盖<strong>所有逻辑分支</strong>。</li> <li><code>cal</code>函数缺乏<strong>弹性</strong>，如果新增一个C等级，或者想修改S等级，那我们必须深入该函数的内部实现，这是违反<strong>开放-封闭</strong>原则的。</li> <li>算法的复用性差，如果在程序的其他地方需要重用这些计算奖金的算法呢？我们只能复制粘贴。</li></ul> <p>  因此我们要重构这段代码。</p> <h3 id="_1-2-计算奖金-组合函数重构"><a href="#_1-2-计算奖金-组合函数重构" aria-hidden="true" class="header-anchor">#</a> 1.2 计算奖金--组合函数重构</h3> <p>  一般最容易想到使用组合函数来重构--我们将各种算法封闭到一个个小函数中，这些小函数有着良好的命名，可以一目了然地知道它对应哪种算法，同时它们也可以被复用到程序其他地方：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token keyword">var</span> <span class="token function-variable function">levelS</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> <span class="token function-variable function">levelA</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> <span class="token function-variable function">levelB</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> <span class="token function-variable function">calculateBonus</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">level<span class="token punctuation">,</span>salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token string">'S'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">levelS</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">levelA</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>leverl <span class="token operator">===</span> <span class="token string">'B'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">levelB</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">calculateBonus</span><span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//24000</span>
</code></pre></div><p>  目前，我们的程序有了一定的改善，但是十分有限，我们依然没有解决最重要的问题：<strong><code>cal</code>函数可能越来越庞大</strong>，且在系统变化时<strong>缺乏弹性</strong>。</p> <h3 id="_1-3-计算奖金-策略模式重构"><a href="#_1-3-计算奖金-策略模式重构" aria-hidden="true" class="header-anchor">#</a> 1.3 计算奖金--策略模式重构</h3> <p>  将<strong>不变</strong>与<strong>变化</strong>的部分隔开是每个设计模式的主题，策略模式也不例外。在这个例子中，算法的使用方式是不变的--都是根据算法取得计算后的奖金数额。而算法的实现是变化的，因为每种绩效对应着不同的计算规则。<br>
  一个基于策略模式的程序<strong>至少由两部分组成</strong>。第一部分是<strong>一组策略类</strong>，策略类封装了具体的算法，并负责具体的计算过程。第二部分是<strong>环境类<code>Context</code></strong>，它接受客户的请求，随后将请求委托给<strong>某一个策略类</strong>。要做到这点，说明<code>Context</code>中要维持对某个策略对象的引用。接下来还是先模仿传统面向对象语言中的实现方式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token comment">//绩效类</span>
	<span class="token keyword">var</span> <span class="token function-variable function">LevelS</span>  <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	levelS<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">cal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">var</span> <span class="token function-variable function">LevelA</span>  <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	levelA<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">cal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">var</span> <span class="token function-variable function">LevelB</span>  <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	levelB<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">cal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//奖金类</span>
	<span class="token keyword">var</span> <span class="token function-variable function">Bonus</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//原始工资</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//绩效等级对应的策略对象</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">Bonus</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setSalary</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> salary<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">Bonus</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setStrategy</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">strategy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">Bonus</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getBonus</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'未设置strategy属性'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     	<span class="token punctuation">}</span>
     	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>  完成最终代码之前，我们来回顾下策略模式的思想：<br></p><div style="text-indent:2em;"><b>&quot;定义一些列的算法，把它们一个个封装起来，并且使它们可以相互替换&quot;</b></div><p></p> <p>  这句话在这里就是我们先创建一个<code>bonus</code>对象，并且给<code>bonus</code>设置工资数额，然后将某个计算奖金的<strong>策略对象</strong>传入<code>bonus</code>对象内部保存起来，当调用<code>getBouns()</code>来计算奖金的时候，<code>bouns</code>对象本身没有能力进行计算，而是将请求委托给了之前保存好的策略对象。其中每次可以传入不同的策略对象，这就是相互替换。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token keyword">var</span> bonus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bonus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	bonus<span class="token punctuation">.</span><span class="token function">setSalary</span><span class="token punctuation">(</span><span class="token number">15000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	bonus<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">levelS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//传入策略对象</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bonus<span class="token punctuation">.</span><span class="token function">getBonus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//60000;</span>
	
	bonus<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">levelA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//传入新的策略对象</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bonus<span class="token punctuation">.</span><span class="token function">getBonus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//45000;</span>
</code></pre></div><h3 id="_1-4-javascript版本策略模式重构"><a href="#_1-4-javascript版本策略模式重构" aria-hidden="true" class="header-anchor">#</a> 1.4 JavaScript版本策略模式重构</h3> <p>  在上一节中我们让<code>strategy对象</code>从各个策略类中创建而来，这是模拟一些传统面向对象语言的实现。实际上<code>JavaScript</code>语言中，函数就是对象，所以更简单和直接的方法是<strong>直接把<code>strategy</code>定义为函数</strong>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token keyword">var</span> strategies <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;S&quot;</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;A&quot;</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;B&quot;</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">salary</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> salary<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>  同样，<code>Context</code>也没有必要必须经过<code>Bonus类</code>来表示，我们依然用<code>cal函数</code>充当<code>Context</code>来接受用户的请求。经过改造，代码的结构变得更加简洁：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token keyword">var</span> <span class="token function-variable function">cal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">level<span class="token punctuation">,</span>salary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> strategies<span class="token punctuation">[</span>level<span class="token punctuation">]</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">cal</span><span class="token punctuation">(</span><span class="token number">15000</span><span class="token punctuation">,</span><span class="token string">'S'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-5-多态在策略模式中的体现"><a href="#_1-5-多态在策略模式中的体现" aria-hidden="true" class="header-anchor">#</a> 1.5 多态在策略模式中的体现</h3> <p>  通过使用策略模式重构代码，我们消除了原程序中<strong>大片的条件分支语句</strong>。所有跟计算奖金有关的逻辑不再放在<code>Context</code>中，而是分布在各个策略对象中。<code>Context</code>并<strong>没有计算奖金的能力</strong>，而是把这个职责<strong>委托</strong>给了某个策略对象，每个策略对象负责的算法已经被各自封装在对象内部。当我们对这些策略对象发出&quot;计算奖金&quot;的请求时，它们会返回各自不同的计算结果，这正是对象<strong>多态</strong>的体现。</p> <h2 id="二、更广义的“算法”"><a href="#二、更广义的“算法”" aria-hidden="true" class="header-anchor">#</a> 二、更广义的“算法”</h2> <p>  从定义上看，策略模式就是用来封装算法的。但如果把策略模式<strong>仅仅</strong>用来封装算法，那就有点大材小用了。在实际开发中，我们通常会将算法的含义<strong>扩散</strong>开来，使策略模式也可以用来封装一系列的“业务规则”。只要这些业务规则指向的<strong>目标一致</strong>，并且可以<strong>替换使用</strong>，那么就可以使用策略模式来封装它。</p> <h3 id="_2-1-表单校验"><a href="#_2-1-表单校验" aria-hidden="true" class="header-anchor">#</a> 2.1 表单校验</h3> <p>  假设我们正在编写一个注册的页面，在点击注册之前，有如下几条校验逻辑：<br>
  ①用户名不可为空<br>
  ②密码长度不能少于6位<br>
  ③手机号码必须符合格式</p> <h3 id="_2-2-表单校验-第一个版本"><a href="#_2-2-表单校验-第一个版本" aria-hidden="true" class="header-anchor">#</a> 2.2 表单校验--第一个版本</h3> <div class="language-html extra-class"><pre class="language-html"><code>	<span class="token doctype">&lt;!DOCTYPE html&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>xxx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>registerForm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            请输入用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userName<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            请输入密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            请输入手机号： <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>phoneNumber<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
            <span class="token keyword">var</span> registerForm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'registerForm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            registerForm<span class="token punctuation">.</span><span class="token function-variable function">onsubmit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>registerForm<span class="token punctuation">.</span>userName<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'用户名不能为空'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>registerForm<span class="token punctuation">.</span>password<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'密码长度不能少于6位'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex">/(^1[3|5|8][0-9]{9}$)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>registerForm<span class="token punctuation">.</span>phoneNumber<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'手机号码格式不正确'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>  这是一种常见的代码编写方式，它的缺点和计算奖金案例的最初版本一模一样：<br>
  ①验证函数十分庞大，包含了很多<code>if</code>语句，这些语句要覆盖<strong>所有校验规则</strong>。<br>
  ②验证函数缺乏<strong>弹性</strong>，如果新增一个校验规则，或者想修改已有的校验规则，那我们必须深入该函数的内部实现，这是违反<strong>开放-封闭</strong>原则的。<br>
  ③算法的复用性差，如果在程序的其他地方需要重用这些表单验证算法呢？我们只能复制粘贴。</p> <h3 id="_2-3-表单校验-策略模式重构"><a href="#_2-3-表单校验-策略模式重构" aria-hidden="true" class="header-anchor">#</a> 2.3 表单校验--策略模式重构</h3> <p>  照葫芦画瓢，我们第一步还是将校验逻辑都封装成策略对象：</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> stategies <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">isNonEmpty</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//不为空</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">minLength</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> length<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//限制最小长度</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">isMobile</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//手机号格式</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex">/(^1[3|5|8][0-9]{9}$)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>  接下来，我们要实现<code>Context--Validator</code>类，负责接受用户的请求，并委托给策略类。在写<code>Validator</code>类之前，我们有必要知道用户如何向<code>Validator</code>类发送请求，这有助于我们知道如何去编写<code>Validator</code>类的代码。代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> validataFunc <span class="token operator">=</span> <span class="token function">funtion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> validator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Validator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建一个validator实例对象</span>

        <span class="token comment">/******添加一些校验规则******/</span>
        validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>registerForm<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> <span class="token string">'isNonEmpty'</span> <span class="token punctuation">,</span> <span class="token string">'用户名不能为空'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>registerForm<span class="token punctuation">.</span>password<span class="token punctuation">,</span> <span class="token string">'minLength:6'</span> <span class="token punctuation">,</span> <span class="token string">'密码长度不能少于6位'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>registerForm<span class="token punctuation">.</span>phoneNumber<span class="token punctuation">,</span> <span class="token string">'isMobile'</span> <span class="token punctuation">,</span> <span class="token string">'手机号格式不正确'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> errorMsg <span class="token operator">=</span> validator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获得校验结果</span>
        <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span> <span class="token comment">//返回校验结果</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> registerForm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'registerForm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    registerForm<span class="token punctuation">.</span><span class="token function-variable function">onsubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> errorMsg <span class="token operator">=</span> <span class="token function">validataFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//如果errorMsg不为空，那么说明未通过校验</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> errotMsg <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span> errorMsg <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//阻止表单提交</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>  在上述代码中，我们首先创建了一个<code>validator</code>对象，然后通过<code>validator.add</code>方法，往<code>validator</code>对象中添加了一些校验规则。<code>validator.add</code>方法接收3个参数，以下面这句代码说明:</p> <div class="language-js extra-class"><pre class="language-js"><code>    validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>registerForm<span class="token punctuation">.</span>password<span class="token punctuation">,</span> <span class="token string">'minLength:6'</span> <span class="token punctuation">,</span> <span class="token string">'密码长度不能少于6位'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1.registerForm.password为参与校验的input输入框</span>
    <span class="token comment">// 2.'minLength:6'是一个以冒号隔开的字符串，冒号前面的minLength代表用户挑选的strategy对象，冒号后面的6表示校验过程中的必须参数，这里表示输入框最小长度为6。如果这个字符串中不含冒号，说明校验过程中不需要额外的参数信息，比如'isNonEmpty'。</span>
    <span class="token comment">// 3.第三个参数表示校验未通过时返回的错误信息</span>
</code></pre></div><p>  当我们往<code>validator</code>对象里添加完一系列的校验规则之后，会调用<code>validator.start()</code>方法来启动校验。如果<code>validator.start()</code>返回了一个确切的<code>errorMsg</code>字符串当作返回值，说明这次校验没有通过，此时需让<code>registerForm.onsubmit</code>方法返回<code>false</code>来阻止表单的校验。<br>
  最后是<code>Validator类</code>的实现：</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> <span class="token function-variable function">Validator</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Validator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> rule<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> ary <span class="token operator">=</span> rule<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将strategy和参数分开</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//将校验的步骤用空函数包装起来，并且放入cache</span>
            <span class="token keyword">let</span> strategy <span class="token operator">=</span> ary<span class="token punctuation">.</span><span class="token function">shifft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用户挑选的strategy</span>
            ary<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将input的value添加进参数列表</span>
            ary<span class="token punctuation">.</span><span class="token function">push</span> <span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将errorMsg添加进参数列表</span>
            <span class="token keyword">return</span> strategies<span class="token punctuation">[</span> strategy <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> dom <span class="token punctuation">,</span> ary<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name">Validator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> validatorFunc<span class="token punctuation">;</span> validatorFunc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cahe<span class="token punctuation">[</span> i<span class="token operator">++</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token function">validatorFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//开始校验，并取得校验后的返回信息</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> msg <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//如果有确切的返回值，说明校验未通过</span>
                <span class="token keyword">return</span> msg
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>  使用策略模式重构代码之后，我们仅仅通过&quot;配置&quot;的方式就可以完成一个表单验证，这些校验规则也可以复用到程序的任何地方，还能作为插件的形式，方便地移植到其他项目中。<br>
  在修改某个校验规则时，只需要编写少量的代码，比如我们想将用户名输入框的校验规则改成用户名不能少于10个字符：</p> <div class="language-js extra-class"><pre class="language-js"><code>    validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> registerForm<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> <span class="token string">'minLength:10'</span><span class="token punctuation">,</span> <span class="token string">'用户名长度不能小于10位'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-4-单个输入框添加多个校验规则"><a href="#_2-4-单个输入框添加多个校验规则" aria-hidden="true" class="header-anchor">#</a> 2.4 单个输入框添加多个校验规则</h3> <p>  目前表单校验只是实现了一个文本输入框对应一种校验规则，但如果我们想为它添加多个校验规则，比如验证用户名输入框是否为空，同时校验它长度不能大于10，这部分内容可以在书上继续学习，这里不再赘述---书籍P83页。</p> <h2 id="三、策略模式的优缺点"><a href="#三、策略模式的优缺点" aria-hidden="true" class="header-anchor">#</a> 三、策略模式的优缺点</h2> <p>  优点：
<ul style="padding-left:3em;"><li>策略模式利用组合、委托和多态等技术的思想，可以有效的<b>避免多重条件选择语句</b></li> <li>策略模式提供了<b>对外-封闭原则</b>的完美支持，将算法封装在strategy中，使其易于切换、理解和扩展</li> <li>策略模式中利用<b>组合和委托</b>来让Context拥有执行算法的能力，这也是继承的一种更为轻便的替代方案</li></ul>
  缺点：
<ul style="padding-left:3em;"><li>首先，使用策略模式会在程序中增加很多<b>策略类和策略对象</b></li> <li>其次，使用策略类<b>必须了解所有strategy以及它们间的不同</b>，这样才能选出一个合适的strategy。比如，我们选择一种合适旅游出行路线，必须先了解选择飞机、火车、自行车等方案的细节。此时strategy要向客户暴露所有的实现，这是违反<b>最少知识原则</b>的</li></ul></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于：: </span> <span class="time">8/7/2019, 11:09:49 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/reading/design-patterns/singleton.html" class="prev">
          4.单例模式
        </a></span> <span class="next"><a href="/reading/design-patterns/template-method.html">
          6.模板方法模式
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2a0bc12.js" defer></script><script src="/assets/js/2.ffc85a67.js" defer></script><script src="/assets/js/18.b72926f6.js" defer></script>
  </body>
</html>
