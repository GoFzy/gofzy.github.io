<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>代理模式 | GoFzy</title>
    <meta name="description" content="脚踏实地，仰望星空">
    <link rel="icon" href="/F.png">
    
    <link rel="preload" href="/assets/css/0.styles.1b9f5e10.css" as="style"><link rel="preload" href="/assets/js/app.e2a0bc12.js" as="script"><link rel="preload" href="/assets/js/2.ffc85a67.js" as="script"><link rel="preload" href="/assets/js/11.bf5ec133.js" as="script"><link rel="prefetch" href="/assets/js/10.16eab02a.js"><link rel="prefetch" href="/assets/js/12.221b6f67.js"><link rel="prefetch" href="/assets/js/13.c6e69e20.js"><link rel="prefetch" href="/assets/js/14.99a9d455.js"><link rel="prefetch" href="/assets/js/15.3a284737.js"><link rel="prefetch" href="/assets/js/16.79d64dc1.js"><link rel="prefetch" href="/assets/js/17.5e406ce6.js"><link rel="prefetch" href="/assets/js/18.b72926f6.js"><link rel="prefetch" href="/assets/js/19.61fc4542.js"><link rel="prefetch" href="/assets/js/20.3db0d9bc.js"><link rel="prefetch" href="/assets/js/21.f4c1528d.js"><link rel="prefetch" href="/assets/js/22.3a481cb5.js"><link rel="prefetch" href="/assets/js/23.cdee567e.js"><link rel="prefetch" href="/assets/js/24.856be0b9.js"><link rel="prefetch" href="/assets/js/25.df567523.js"><link rel="prefetch" href="/assets/js/26.08fc6653.js"><link rel="prefetch" href="/assets/js/27.1b4e7bc2.js"><link rel="prefetch" href="/assets/js/28.a8b8135e.js"><link rel="prefetch" href="/assets/js/29.7b17ab5a.js"><link rel="prefetch" href="/assets/js/3.dc5d0d43.js"><link rel="prefetch" href="/assets/js/30.dd840729.js"><link rel="prefetch" href="/assets/js/31.3f22bf3e.js"><link rel="prefetch" href="/assets/js/32.998c6ce0.js"><link rel="prefetch" href="/assets/js/33.75bd15bf.js"><link rel="prefetch" href="/assets/js/34.bcb04044.js"><link rel="prefetch" href="/assets/js/35.2494bca3.js"><link rel="prefetch" href="/assets/js/36.cd36c95a.js"><link rel="prefetch" href="/assets/js/37.f13bf26a.js"><link rel="prefetch" href="/assets/js/38.b19352c9.js"><link rel="prefetch" href="/assets/js/39.3c848e8d.js"><link rel="prefetch" href="/assets/js/4.c516a99f.js"><link rel="prefetch" href="/assets/js/40.4ead735b.js"><link rel="prefetch" href="/assets/js/41.dde15470.js"><link rel="prefetch" href="/assets/js/5.28430339.js"><link rel="prefetch" href="/assets/js/6.206f7f91.js"><link rel="prefetch" href="/assets/js/7.f065ebd0.js"><link rel="prefetch" href="/assets/js/8.6c06ae76.js"><link rel="prefetch" href="/assets/js/9.32855513.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1b9f5e10.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">GoFzy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link router-link-active">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link router-link-active">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/reading/design-patterns/" class="sidebar-link">JavaScript设计模式与开发实践</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading/design-patterns/prototypical.html" class="sidebar-link">1.原型继承</a></li><li><a href="/reading/design-patterns/about-this.html" class="sidebar-link">2.this、apply和call</a></li><li><a href="/reading/design-patterns/closure.html" class="sidebar-link">3.闭包和高阶函数</a></li><li><a href="/reading/design-patterns/singleton.html" class="sidebar-link">4.单例模式</a></li><li><a href="/reading/design-patterns/strategy-pattern.html" class="sidebar-link">5.策略模式</a></li><li><a href="/reading/design-patterns/template-method.html" class="sidebar-link">6.模板方法模式</a></li><li><a href="/reading/design-patterns/publish-subscribe.html" class="sidebar-link">7.发布订阅模式</a></li><li><a href="/reading/" class="sidebar-link">返回上一级</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="代理模式"><a href="#代理模式" aria-hidden="true" class="header-anchor">#</a> 代理模式</h1> <h2 id="一、定义"><a href="#一、定义" aria-hidden="true" class="header-anchor">#</a> 一、定义</h2> <p><strong>代理模式</strong>：为一个对象提供一个<strong>代用品</strong>或<strong>占位符</strong>，以便控制对它的访问。代理模式的<strong>关键</strong>是，当客户不方便直接访问一个对象或者不满足需要的时候，为其提供一个替身对象来控制对这个对象的访问。<br>
  而实际上，客户访问的是替身对象。替身对象对请求作出一些处理之后，再把请求转交给本体对象。</p> <h3 id="_1-1-保护代理和虚拟代理"><a href="#_1-1-保护代理和虚拟代理" aria-hidden="true" class="header-anchor">#</a> 1.1 保护代理和虚拟代理</h3> <p>  以送花为例，代理<code>B</code>可以帮助对象<code>A</code>过滤掉一些请求，比如送花的人中年龄太大或者没有车，这种请求就可以直接在代理<code>B</code>处被拒绝---这种代理形式就叫<code>保护代理</code>。<br>
  另外，假设现实中花的价格不菲，导致在程序世界里，<code>new Flower</code>也是一个代价昂贵的操作，那么我们可以把<code>new Flower</code>的操作交给代理<code>B</code>去执行，代理<code>B</code>会选择在<code>A</code>心情好时再执行<code>new Flower</code>---这种代理形式就叫<code>虚拟代理</code>。虚拟代理可以把一些开销很大的对象，<strong>延迟</strong>到真正需要它的时候才去创建。代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token keyword">let</span> <span class="token constant">B</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">receiveFlower</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">flower</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">listenGoodMood</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> flower <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Flower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//监听A的好心情</span>
                <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">receiveFlower</span><span class="token punctuation">(</span> flower <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//延迟创建flower对象</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>  保护代理用于控制不同<strong>权限的对象</strong>对目标对象的访问，但在<code>JavaScript</code>并不容易实现保护代理，因为我们<strong>无法判断谁访问了目标对象</strong>。而虚拟代理是最常用的一种代理模式，本章亦主要讨论虚拟代理。</p> <h2 id="二、虚拟代理实现图片预加载"><a href="#二、虚拟代理实现图片预加载" aria-hidden="true" class="header-anchor">#</a> 二、虚拟代理实现图片预加载</h2> <p>  在<code>Web</code>开发中，图片预加载是一种常用的技术，如果直接给某个<code>img</code>标签节点设置<code>src</code>属性，由于某些图片过大或者网络不佳，图片的位置往往有段时间会是<strong>一片空白</strong>。常见的做法是先用一张<code>loading</code>图片站位，然后用<code>异步</code>的方式加载图片，等图片加载好了再把它填充到<code>img</code>节点里，这种场景就很适合使用虚拟代理。<br>
  首先创建一个普通的本体对象，这个对象负责往页面中创建一个<code>img</code>标签，并且提供一个对外的<code>setSrc</code>接口，外界调用这个接口，便可以给该<code>img</code>标签设置<code>src</code>属性：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token keyword">let</span> myImage <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> imgNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>imgNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">setSrc</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           	imgNode<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	myImage<span class="token punctuation">.</span><span class="token function">setSrc</span><span class="token punctuation">(</span><span class="token string">'http://i3.sinaimg.cn/gm/o/i/2008-09-03/U1901P115T41D148033F757DT20080903105357.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>  如果将网速调至<code>slow 3G</code>，可以看到在图片被加载好之前，页面中有一段长长的空白时间。现在我们引入带来对象<code>proxyImage</code>，通过这个代理对象，在图片被真正加载好之前，页面中将会出现一张展位图<code>loading.gif</code>来提示用户正在加载：</p> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">let</span> proxyImage <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">;</span>
        <span class="token comment">//图片加载完后执行</span>
        img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            myImage<span class="token punctuation">.</span><span class="token function">setSrc</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>src <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">setSrc</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    myImage<span class="token punctuation">.</span><span class="token function">setSrc</span><span class="token punctuation">(</span><span class="token string">'./loading.gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    img<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	proxyImage<span class="token punctuation">.</span><span class="token function">setSrc</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>  现在我们通过<code>proxyImage</code>间接地访问<code>MyImage</code>。前者控制了客户对<code>MyImage</code>的访问，且在此过程中加入一些额外的操作。</p> <h2 id="三、代理的意义"><a href="#三、代理的意义" aria-hidden="true" class="header-anchor">#</a> 三、代理的意义</h2> <p>  为了说明代理的意义，下面我们引入一个面向对象设计的原则--单一职责原则。<br> <strong>单一职责</strong>原则指的是，一个类应该仅有<strong>一个</strong>引起它变化的原因。如果一个对象承担了多项职责，就意味着该对象将变得巨大，引起它的原因可能会有多个。<br>
  如果一个对象承担的职责过多，就相当于将这些职责<strong>耦合</strong>到了一起，这种耦合会导致脆弱和低内聚的设计。<br>
  如果不使用代理模式，我们需要<code>MyImage</code>对象除了给<code>img</code>节点设置<code>src</code>外，还要负责预加载图片。我们在处理其中一个职责时，有可能因为其强耦合性影响另一个职责的实现。<br>
  另外，在面向对象的程序设计中，大多数情况下，若违反其他任何原则，同时将违反<strong>开放-封闭</strong>原则。如果我们只是从网上获取一些体积很小的图片，那就可能希望将预加载从<code>MyImage</code>对象里删掉，而这时候就不得不改动<code>MyImage</code>对象了。如果能把这个预加载操作放在另一个对象中，自然是一个很好的方法。于是代理的作用在这里就体现出来了 ，代理负载加载图片，预加载完成后，将请求重新交给本体对象。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于：: </span> <span class="time">8/7/2019, 11:09:49 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2a0bc12.js" defer></script><script src="/assets/js/2.ffc85a67.js" defer></script><script src="/assets/js/11.bf5ec133.js" defer></script>
  </body>
</html>
