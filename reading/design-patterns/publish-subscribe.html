<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>发布-订阅模式 | GoFzy</title>
    <meta name="description" content="脚踏实地，仰望星空">
    <link rel="icon" href="/F.png">
    
    <link rel="preload" href="/assets/css/0.styles.1b9f5e10.css" as="style"><link rel="preload" href="/assets/js/app.e2a0bc12.js" as="script"><link rel="preload" href="/assets/js/2.ffc85a67.js" as="script"><link rel="preload" href="/assets/js/16.79d64dc1.js" as="script"><link rel="prefetch" href="/assets/js/10.16eab02a.js"><link rel="prefetch" href="/assets/js/11.bf5ec133.js"><link rel="prefetch" href="/assets/js/12.221b6f67.js"><link rel="prefetch" href="/assets/js/13.c6e69e20.js"><link rel="prefetch" href="/assets/js/14.99a9d455.js"><link rel="prefetch" href="/assets/js/15.3a284737.js"><link rel="prefetch" href="/assets/js/17.5e406ce6.js"><link rel="prefetch" href="/assets/js/18.b72926f6.js"><link rel="prefetch" href="/assets/js/19.61fc4542.js"><link rel="prefetch" href="/assets/js/20.3db0d9bc.js"><link rel="prefetch" href="/assets/js/21.f4c1528d.js"><link rel="prefetch" href="/assets/js/22.3a481cb5.js"><link rel="prefetch" href="/assets/js/23.cdee567e.js"><link rel="prefetch" href="/assets/js/24.856be0b9.js"><link rel="prefetch" href="/assets/js/25.df567523.js"><link rel="prefetch" href="/assets/js/26.08fc6653.js"><link rel="prefetch" href="/assets/js/27.1b4e7bc2.js"><link rel="prefetch" href="/assets/js/28.a8b8135e.js"><link rel="prefetch" href="/assets/js/29.7b17ab5a.js"><link rel="prefetch" href="/assets/js/3.dc5d0d43.js"><link rel="prefetch" href="/assets/js/30.dd840729.js"><link rel="prefetch" href="/assets/js/31.3f22bf3e.js"><link rel="prefetch" href="/assets/js/32.998c6ce0.js"><link rel="prefetch" href="/assets/js/33.75bd15bf.js"><link rel="prefetch" href="/assets/js/34.bcb04044.js"><link rel="prefetch" href="/assets/js/35.2494bca3.js"><link rel="prefetch" href="/assets/js/36.cd36c95a.js"><link rel="prefetch" href="/assets/js/37.f13bf26a.js"><link rel="prefetch" href="/assets/js/38.b19352c9.js"><link rel="prefetch" href="/assets/js/39.3c848e8d.js"><link rel="prefetch" href="/assets/js/4.c516a99f.js"><link rel="prefetch" href="/assets/js/40.4ead735b.js"><link rel="prefetch" href="/assets/js/41.dde15470.js"><link rel="prefetch" href="/assets/js/5.28430339.js"><link rel="prefetch" href="/assets/js/6.206f7f91.js"><link rel="prefetch" href="/assets/js/7.f065ebd0.js"><link rel="prefetch" href="/assets/js/8.6c06ae76.js"><link rel="prefetch" href="/assets/js/9.32855513.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1b9f5e10.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">GoFzy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link router-link-active">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link router-link-active">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/reading/design-patterns/" class="sidebar-link">JavaScript设计模式与开发实践</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading/design-patterns/prototypical.html" class="sidebar-link">1.原型继承</a></li><li><a href="/reading/design-patterns/about-this.html" class="sidebar-link">2.this、apply和call</a></li><li><a href="/reading/design-patterns/closure.html" class="sidebar-link">3.闭包和高阶函数</a></li><li><a href="/reading/design-patterns/singleton.html" class="sidebar-link">4.单例模式</a></li><li><a href="/reading/design-patterns/strategy-pattern.html" class="sidebar-link">5.策略模式</a></li><li><a href="/reading/design-patterns/template-method.html" class="sidebar-link">6.模板方法模式</a></li><li><a href="/reading/design-patterns/publish-subscribe.html" class="active sidebar-link">7.发布订阅模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading/design-patterns/publish-subscribe.html#一、定义" class="sidebar-link">一、定义</a></li><li class="sidebar-sub-header"><a href="/reading/design-patterns/publish-subscribe.html#二、发布-订阅模式购房案例" class="sidebar-link">二、发布-订阅模式购房案例</a></li><li class="sidebar-sub-header"><a href="/reading/design-patterns/publish-subscribe.html#三、真实的例子——网站登录" class="sidebar-link">三、真实的例子——网站登录</a></li><li class="sidebar-sub-header"><a href="/reading/design-patterns/publish-subscribe.html#四、全局的发布-订阅对象" class="sidebar-link">四、全局的发布-订阅对象</a></li></ul></li><li><a href="/reading/" class="sidebar-link">返回上一级</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="发布-订阅模式"><a href="#发布-订阅模式" aria-hidden="true" class="header-anchor">#</a> 发布-订阅模式</h1> <h2 id="一、定义"><a href="#一、定义" aria-hidden="true" class="header-anchor">#</a> 一、定义</h2> <p>发布-订阅模式又称观察者模式，它定义<strong>对象间的一对多</strong>的依赖关系，当一个对象的状态发生改变时，所有依赖它的对象都将得到通知。在 <code>JS</code> 开发中，我们一般用<strong>事件模型</strong>来替代传统的发布-订阅模式</p> <h2 id="二、发布-订阅模式购房案例"><a href="#二、发布-订阅模式购房案例" aria-hidden="true" class="header-anchor">#</a> 二、发布-订阅模式购房案例</h2> <p>比如我们在现实生活中购房时，一般会将手机号留在售楼处。而当有新楼盘推出时，销售人员就会翻开电话簿，遍历上面的电话号码并依次发送短息通知<br>
上述例子就是一个典型的发布-订阅模式，其中售楼处为<strong>发布者</strong>，购房者为<strong>订阅者</strong>，而该模式的优势在于:</p> <ul><li>购房者不用再天天给售楼处打电话咨询开售时间，在合适的时间点，售楼处作为发布者会通知这些消息订阅者</li> <li>购房者和售楼处之间不再强耦合在一起，当有新的购房者出现时，他只需把手机号码留在售楼处，售楼处不关心购房者的任何情况。 而售楼处的任何变动也不会影响购买者</li></ul> <p>第一点说明发布—订阅模式可以广泛应用于<strong>异步编程</strong>中，这是一种替代传递回调函数的方案。比如，我们可以订阅 <code>ajax</code> 请求的 <code>error、succ</code> 等事件。在异步编程中使用发布—订阅模式，我们就无需过多关注对象在异步运行期间的内部状态，而只需要订阅感兴趣的事件发生点<br>
第二点说明发布—订阅模式可以取代对象之间硬编码的通知机制，一个对象不用再显式地调用另外一个对象的某个接口。发布—订阅模式让两个对象<strong>松耦合</strong>地联系在一起，虽然不太清楚彼此的细节，但这不影响它们之间相互通信。当有新的订阅者出现时，发布者的代码不需要任何修改；同样发布者需要改变时，也不会影响到之前的订阅者。只要之前约定的事件名没有变化，就可以自由地改变它们</p> <h3 id="简单实现"><a href="#简单实现" aria-hidden="true" class="header-anchor">#</a> 简单实现</h3> <p>现在看看如何一步步实现发布—订阅模式：</p> <ul><li>首先要指定好谁充当发布者（比如售楼处）</li> <li>然后给发布者添加一个缓存列表，用于存放回调函数以便通知订阅者（售楼处的花名册）</li> <li>最后发布消息的时候，发布者会遍历这个缓存列表，依次触发里面存放的订阅者回调函数（遍历花名册，挨个发短信）</li></ul> <p>另外，我们还可以往回调函数里填入一些参数，订阅者可以接收这些参数。这是很有必要的，比如售楼处可以在发给订阅者的短信里加上房子的单价、面积、容积率等信息，订阅者接收到这些信息之后可以进行各自的处理：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> salesOffices <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>             <span class="token comment">// 定义售楼处</span>

salesOffices<span class="token punctuation">.</span>clientList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// 缓存列表，存放订阅者的回调函数</span>

salesOffices<span class="token punctuation">.</span><span class="token function-variable function">listen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 增加订阅者</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

salesOffices<span class="token punctuation">.</span><span class="token function-variable function">trigger</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 发布消息</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> fn <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

salesOffices<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">price<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'f订阅-价格:'</span><span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'f订阅-面积:'</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

salesOffices<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">price<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'z订阅-价格:'</span><span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'z订阅-面积:'</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

salesOffices<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span> <span class="token number">2000000</span><span class="token punctuation">,</span> <span class="token number">88</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
salesOffices<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span> <span class="token number">3000000</span><span class="token punctuation">,</span> <span class="token number">110</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>至此，我们已经实现了一个最简单的发布—订阅模式，但这里还存在一些问题。我们看到订阅者接收到了发布者发布的每个消息，虽然小明只想买 88 平方米的房子，但是发布者把 110 平方米的信息也推送给了小明，这对小明来说是不必要的困扰。所以我们有必要增加一个标示 <code>key</code>，让订阅者只订阅自己感兴趣的消息。改写后的代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> salesOffices <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>                   <span class="token comment">// 定义售楼处</span>

salesOffices<span class="token punctuation">.</span>clientList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token comment">// 缓存列表，存放订阅者的回调函数</span>

salesOffices<span class="token punctuation">.</span><span class="token function-variable function">listen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 增加订阅者</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token comment">// 订阅者只订阅自己想要的信息</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

salesOffices<span class="token punctuation">.</span><span class="token function-variable function">trigger</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 发布消息</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fns <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clientList<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fns <span class="token operator">||</span> <span class="token operator">!</span>fns<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> fn <span class="token keyword">of</span> fns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

salesOffices<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'size88'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'f订阅-价格:'</span><span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

salesOffices<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'size110'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'z订阅-价格:'</span><span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

salesOffices<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span> <span class="token string">'size88'</span><span class="token punctuation">,</span> <span class="token number">2000000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发布 88 平方米房子的价格</span>
salesOffices<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span> <span class="token string">'size110'</span><span class="token punctuation">,</span> <span class="token number">3000000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发布 110 平方米房子的价格</span>
</code></pre></div><h2 id="三、真实的例子——网站登录"><a href="#三、真实的例子——网站登录" aria-hidden="true" class="header-anchor">#</a> 三、真实的例子——网站登录</h2> <p>假如我们正在开发一个商城网站，网站里有 <code>header</code> 头部、<code>nav</code> 导航、消息列表、购物车等模块。这几个模块的渲染有一个共同的前提条件，就是必须先用 <code>ajax</code> 异步请求获取用户的登录信息。这是很正常的，比如用户的名字和头像要显示在 <code>header</code> 模块里，而这两个字段都来自用户登录后返回的信息<br>
至于 <code>ajax</code> 请求什么时候能成功返回用户信息，这点我们没有办法确定。现在的情节看起来像极了售楼处的例子，小明不知道什么时候开发商的售楼手续能够成功办下来<br>
异步的问题通常也可以用回调函数来解决。但问题在于，我们不知道除了 <code>header</code> 头部、<code>nav</code> 导航、消息列表、购物车之外，将来还有哪些模块需要使用这些用户信息。如果使用回调形式，那么它们就会和用户信息模块产生强耦合，比如下面这样的形式：</p> <div class="language-js extra-class"><pre class="language-js"><code>login<span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
  header<span class="token punctuation">.</span><span class="token function">setAvatar</span><span class="token punctuation">(</span> data<span class="token punctuation">.</span>avatar<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置 header 模块的头像</span>
  nav<span class="token punctuation">.</span><span class="token function">setAvatar</span><span class="token punctuation">(</span> data<span class="token punctuation">.</span>avatar <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 设置导航模块的头像</span>
  message<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 刷新消息列表</span>
  cart<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 刷新购物车列表</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>现在登录模块是我们负责编写的，但我们还必须了解 <code>header</code> 模块里设置头像的方法叫 <code>setAvatar</code>、购物车模块里刷新的方法叫 <code>refresh</code>，这种耦合性会使程序变得僵硬，<code>header</code> 模块不能随意再改变 <code>setAvatar</code> 的方法名，它自身的名字也不能被改为 <code>header1</code>、<code>header2</code><br>
等到有一天，项目中又新增了一个收货地址管理的模块，于是你又得在最后部分加上这行代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>login<span class="token punctuation">.</span><span class="token function">succ</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">data</span> <span class="token punctuation">)</span><span class="token punctuation">{</span> 
  header<span class="token punctuation">.</span><span class="token function">setAvatar</span><span class="token punctuation">(</span> data<span class="token punctuation">.</span>avatar<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  nav<span class="token punctuation">.</span><span class="token function">setAvatar</span><span class="token punctuation">(</span> data<span class="token punctuation">.</span>avatar <span class="token punctuation">)</span><span class="token punctuation">;</span> 
  message<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  cart<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  address<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 增加这行代码</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>而用发布—订阅模式重写之后，对用户信息感兴趣的业务模块将<strong>自行订阅</strong>登录成功的消息事件。当登录成功时，登录模块只需要发布登录成功的消息，而业务方接受到消息之后，就会开始进行各自的业务处理，登录模块并不关心业务方究竟要做什么，也不想去了解它们的内部细节。改善后的代码如下:</p> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">'http:// xxx.com?login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 登录成功</span>
 login<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span> <span class="token string">'loginSucc'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 发布登录成功的消息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>各模块监听登录成功的消息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// header 模块</span>
    login<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span> <span class="token string">'loginSucc'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">data</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      header<span class="token punctuation">.</span><span class="token function">setAvatar</span><span class="token punctuation">(</span> data<span class="token punctuation">.</span>avatar <span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">{</span> 
    <span class="token function-variable function">setAvatar</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">data</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'设置 header 模块的头像'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> nav <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// nav 模块</span>
    login<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span> <span class="token string">'loginSucc'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">data</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      nav<span class="token punctuation">.</span><span class="token function">setAvatar</span><span class="token punctuation">(</span> data<span class="token punctuation">.</span>avatar <span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">{</span> 
    <span class="token function-variable function">setAvatar</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">avatar</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'设置 nav 模块的头像'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如上所述，我们随时可以把 <code>setAvatar</code> 的方法名改成其他名称。如果有一天在登录完成之后，又增加一个刷新收货地址列表的行为，那么只要在收货地址模块里加上监听消息的方法即可，而这可以让开发该模块的同事自己完成，你作为登录模块的开发者，永远不用再关心这些行为了。代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> address <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// nav 模块</span>
    login<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span> <span class="token string">'loginSucc'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">obj</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    address<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span> obj <span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">return</span> <span class="token punctuation">{</span> 
  <span class="token function-variable function">refresh</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">avatar</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'刷新收货地址列表'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="四、全局的发布-订阅对象"><a href="#四、全局的发布-订阅对象" aria-hidden="true" class="header-anchor">#</a> 四、全局的发布-订阅对象</h2> <p>回想下刚刚实现的发布—订阅模式，我们给售楼处对象和登录对象都添加了订阅和发布的功能，这里还存在两个小问题:</p> <ul><li>我们给每个发布者对象都添加了 <code>listen</code> 和 <code>trigger</code> 方法，以及一个缓存列表 <code>clientList</code>，这其实是一种资源浪费</li> <li>小明跟售楼处对象还是存在一定的耦合性，小明至少要知道售楼处对象的名字是 <code>salesOffices</code>，才能顺利的订阅到事件。见如下代码：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>salesOffices<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span> <span class="token string">'squareMeter100'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">price</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 小明订阅消息</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'价格= '</span> <span class="token operator">+</span> price <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果小明还关心 300 平方米的房子，而这套房子的卖家是 <code>salesOffices2</code>，这意味着小明要开始订阅 <code>salesOffices2</code> 对象。见如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>salesOffices2<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span> <span class="token string">'squareMeter300'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">price</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 小明订阅消息</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'价格= '</span> <span class="token operator">+</span> price <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>其实在现实中，买房子未必要亲自去售楼处，我们只要把订阅的请求交给<strong>中介公司</strong>，而各大房产公司也只需要通过中介公司来发布房子信息。这样一来，我们不用关心消息是来自哪个房产公司，我们在意的是能否顺利收到消息。当然，为了保证订阅者和发布者能顺利通信，订阅者和发布者都必须知道这个中介公司<br>
同样在程序中，发布—订阅模式可以用一个全局的 <code>Event</code> 对象来实现，订阅者不需要了解消息来自哪个发布者，发布者也不知道消息会推送给哪些订阅者，<code>Event</code> 作为一个类似<strong>中介者</strong>的角色，把订阅者和发布者联系起来。见如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Event <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> clientList <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      listen<span class="token punctuation">,</span>
      trigger<span class="token punctuation">,</span>
      remove<span class="token punctuation">;</span>
  <span class="token function-variable function">listen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>clientList<span class="token punctuation">[</span> key <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      clientList<span class="token punctuation">[</span> key <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    clientList<span class="token punctuation">[</span> key <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> fn <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">trigger</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> arguments <span class="token punctuation">)</span><span class="token punctuation">,</span>
        fns <span class="token operator">=</span> clientList<span class="token punctuation">[</span> key <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>fns <span class="token operator">||</span> <span class="token operator">!</span>fns<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> fn <span class="token keyword">of</span> fns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">key<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fns <span class="token operator">=</span> clientList<span class="token punctuation">[</span> key <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>fns <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>fn <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fns <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span> fns<span class="token punctuation">.</span>length <span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> index <span class="token operator">=</span> fns<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">~</span>index <span class="token operator">&amp;&amp;</span> fns<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    listen<span class="token punctuation">:</span> listen<span class="token punctuation">,</span>
    trigger<span class="token punctuation">:</span> trigger<span class="token punctuation">,</span>
    remove<span class="token punctuation">:</span> remove<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

Event<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span> <span class="token string">'squareMeter88'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">price</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 小红订阅消息</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'价格= '</span> <span class="token operator">+</span> price <span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// 输出：'价格=2000000' </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
Event<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span> <span class="token string">'squareMeter88'</span><span class="token punctuation">,</span> <span class="token number">2000000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 售楼处发布消息</span>
</code></pre></div><h3 id="五、模块间通信"><a href="#五、模块间通信" aria-hidden="true" class="header-anchor">#</a> 五、模块间通信</h3> <p>上一节中实现的发布—订阅模式的实现，是基于一个全局的 <code>Event</code> 对象，我们利用它可以在两个封装良好的模块中进行通信，这两个模块可以完全不知道对方的存在。就如同有了中介公司之后，我们不再需要知道房子开售的消息来自哪个售楼处<br>
比如现在有两个模块，<code>a</code> 模块里面有一个按钮，每次点击按钮之后，<code>b</code> 模块里的 <code>div</code> 中会显示按钮的总点击次数，我们用全局发布—订阅模式完成下面的代码，使得 <code>a</code> 模块和 <code>b</code> 模块可以在保持封装性的前提下进行通信</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/JavaScript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token string">'count'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    button<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      Event<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span> <span class="token string">'add'</span><span class="token punctuation">,</span> count<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token string">'show'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    Event<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span> <span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">count</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> count<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="六、小结"><a href="#六、小结" aria-hidden="true" class="header-anchor">#</a> 六、小结</h3> <p>发布—订阅模式的优点非常明显，一为<strong>时间上</strong>的解耦，二为<strong>对象之间</strong>的解耦<br>
它的应用非常广泛，既可以用在异步编程中，也可以帮助我们完成更松耦合的代码编写。还可以用来帮助实现一些别的设计模式，比如中介者模式。从架构上来看，无论是 <code>MVC</code> 还是 <code>MVVM</code>，都少不了发布—订阅模式的参与，而且 <code>JavaScript</code> 本身也是一门基于事件驱动的语言。</p> <p>个人对发布-订阅模式的理解:</p> <ul><li>时间上的<strong>解耦</strong>，对于异步事件，不再需要将逻辑全部集中在回调之中</li> <li>对象上的<strong>解耦</strong>，各个订阅对象自行订阅即可，便于扩展</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于：: </span> <span class="time">9/12/2019, 10:06:29 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/reading/design-patterns/template-method.html" class="prev">
          6.模板方法模式
        </a></span> <span class="next"><a href="/reading/" class="router-link-active">
          返回上一级
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2a0bc12.js" defer></script><script src="/assets/js/2.ffc85a67.js" defer></script><script src="/assets/js/16.79d64dc1.js" defer></script>
  </body>
</html>
