<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Set 与 WeakSet数据结构 | GoFzy</title>
    <meta name="description" content="脚踏实地，仰望星空">
    <link rel="icon" href="/F.png">
    
    <link rel="preload" href="/assets/css/0.styles.1b9f5e10.css" as="style"><link rel="preload" href="/assets/js/app.e2a0bc12.js" as="script"><link rel="preload" href="/assets/js/2.ffc85a67.js" as="script"><link rel="preload" href="/assets/js/26.08fc6653.js" as="script"><link rel="prefetch" href="/assets/js/10.16eab02a.js"><link rel="prefetch" href="/assets/js/11.bf5ec133.js"><link rel="prefetch" href="/assets/js/12.221b6f67.js"><link rel="prefetch" href="/assets/js/13.c6e69e20.js"><link rel="prefetch" href="/assets/js/14.99a9d455.js"><link rel="prefetch" href="/assets/js/15.3a284737.js"><link rel="prefetch" href="/assets/js/16.79d64dc1.js"><link rel="prefetch" href="/assets/js/17.5e406ce6.js"><link rel="prefetch" href="/assets/js/18.b72926f6.js"><link rel="prefetch" href="/assets/js/19.61fc4542.js"><link rel="prefetch" href="/assets/js/20.3db0d9bc.js"><link rel="prefetch" href="/assets/js/21.f4c1528d.js"><link rel="prefetch" href="/assets/js/22.3a481cb5.js"><link rel="prefetch" href="/assets/js/23.cdee567e.js"><link rel="prefetch" href="/assets/js/24.856be0b9.js"><link rel="prefetch" href="/assets/js/25.df567523.js"><link rel="prefetch" href="/assets/js/27.1b4e7bc2.js"><link rel="prefetch" href="/assets/js/28.a8b8135e.js"><link rel="prefetch" href="/assets/js/29.7b17ab5a.js"><link rel="prefetch" href="/assets/js/3.dc5d0d43.js"><link rel="prefetch" href="/assets/js/30.dd840729.js"><link rel="prefetch" href="/assets/js/31.3f22bf3e.js"><link rel="prefetch" href="/assets/js/32.998c6ce0.js"><link rel="prefetch" href="/assets/js/33.75bd15bf.js"><link rel="prefetch" href="/assets/js/34.bcb04044.js"><link rel="prefetch" href="/assets/js/35.2494bca3.js"><link rel="prefetch" href="/assets/js/36.cd36c95a.js"><link rel="prefetch" href="/assets/js/37.f13bf26a.js"><link rel="prefetch" href="/assets/js/38.b19352c9.js"><link rel="prefetch" href="/assets/js/39.3c848e8d.js"><link rel="prefetch" href="/assets/js/4.c516a99f.js"><link rel="prefetch" href="/assets/js/40.4ead735b.js"><link rel="prefetch" href="/assets/js/41.dde15470.js"><link rel="prefetch" href="/assets/js/5.28430339.js"><link rel="prefetch" href="/assets/js/6.206f7f91.js"><link rel="prefetch" href="/assets/js/7.f065ebd0.js"><link rel="prefetch" href="/assets/js/8.6c06ae76.js"><link rel="prefetch" href="/assets/js/9.32855513.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1b9f5e10.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">GoFzy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link router-link-active">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about-me/" class="nav-link">个人介绍</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">知识体系</a></div><div class="nav-item"><a href="/source-code/" class="nav-link">源码学习</a></div><div class="nav-item"><a href="/reading/" class="nav-link router-link-active">读书笔记</a></div><div class="nav-item"><a href="https://github.com/GoFzy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/reading/es6/" class="sidebar-link">ES6 标准入门(第3版)</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/reading/es6/function-extend.html" class="sidebar-link">函数的扩展</a></li><li><a href="/reading/es6/promise.html" class="sidebar-link">Promise对象</a></li><li><a href="/reading/es6/generator.html" class="sidebar-link">Generator函数</a></li><li><a href="/reading/es6/async.html" class="sidebar-link">async函数</a></li><li><a href="/reading/es6/set-weakset.html" class="active sidebar-link">Set 与 WeakSet数据结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/reading/es6/set-weakset.html#set" class="sidebar-link">Set</a></li><li class="sidebar-sub-header"><a href="/reading/es6/set-weakset.html#weakset" class="sidebar-link">WeakSet</a></li><li class="sidebar-sub-header"><a href="/reading/es6/set-weakset.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/reading/es6/map-weakmap.html" class="sidebar-link">Map 与 WeakMap数据结构</a></li><li><a href="/reading/" class="sidebar-link">返回上一级</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="set-与-weakset数据结构"><a href="#set-与-weakset数据结构" aria-hidden="true" class="header-anchor">#</a> Set 与 WeakSet数据结构</h1> <h2 id="set"><a href="#set" aria-hidden="true" class="header-anchor">#</a> Set</h2> <h3 id="基本概念"><a href="#基本概念" aria-hidden="true" class="header-anchor">#</a> 基本概念</h3> <p><code>ES6</code> 提供了新的数据结构 <code>Set</code>。它类似于数组，但是成员的值都是唯一的，<strong>没有重复的值</strong>。而<code>Set</code>本身是一个构造函数，用来生成 <code>Set</code> 数据结构</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2 3 5 4</span>
</code></pre></div><p>上述代码通过 <code>add()</code> 方法向 <code>Set</code> 结构加入成员，结果表明 <code>Set</code> 结构不会添加重复的值<br>
此外，<code>Set</code> 函数可以接受一个数组（或者具有 <code>iterable</code> 接口的其他数据结构）作为参数，用来初始化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>set<span class="token punctuation">)</span>              <span class="token comment">// 1 2 3 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span>            <span class="token comment">// 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>          <span class="token comment">// undefined</span>
</code></pre></div><p>上述代码中可以看出 <code>Set</code> 函数可以直接接受一个数组作为输入参数，同时使用 <code>size</code> 属性来计算长度</p> <h3 id="set应用"><a href="#set应用" aria-hidden="true" class="header-anchor">#</a> Set应用</h3> <p>这里介绍下 <code>Set</code> 在数组和字符串中的去重</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 去除数组的重复成员</span>
<span class="token punctuation">[</span><span class="token operator">...</span>new <span class="token class-name">Set</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span><span class="token operator">...</span>new <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token string">'ababbc'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
</code></pre></div><p>向 <code>Set</code> 加入值的时候，不会发生类型转换，所以 <code>5</code> 和 <code>&quot;5&quot;</code> 是两个不同的值。<code>Set</code> 内部判断两个值是否不同，使用的算法叫做<code>Same-value-zero equality</code>，它类似于精确相等运算符（<code>===</code>），主要的区别是向 <code>Set</code> 加入值时认为 <code>NaN</code>等于<strong>自身</strong>，而精确相等运算符认为 <code>NaN</code> 不等于自身:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">NaN</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">NaN</span><span class="token punctuation">;</span>
<span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token comment">// Set {NaN}</span>
</code></pre></div><h3 id="set实例的属性和方法"><a href="#set实例的属性和方法" aria-hidden="true" class="header-anchor">#</a> Set实例的属性和方法</h3> <p><code>Set</code> 结构的实例有以下属性：</p> <ul><li><code>Set.prototype.constructor</code>：构造函数，默认就是 <code>Set</code> 函数</li> <li><code>Set.prototype.size</code>：返回 <code>Set</code> 实例的成员总数</li></ul> <p><code>Set</code> 实例的方法分为两大类：<strong>操作方法</strong>(用于操作数据)以及<strong>遍历方法</strong>(用于遍历成员)</p> <p>这里先介绍四个操作方法：</p> <ul><li><code>Set.prototype.add(value)</code>：添加某个值，返回 <code>Set</code> 结构本身</li> <li><code>Set.prototype.delete(value)</code>：删除某个值，返回一个布尔值，表示删除是否成功</li> <li><code>Set.prototype.has(value)</code>：返回一个布尔值，表示该值是否为 <code>Set</code> 的成员</li> <li><code>Set.prototype.clear()</code>：清除所有成员，没有返回值</li></ul> <p>然后是四个遍历操作，可以用于遍历成员:</p> <ul><li><code>Set.prototype.keys()</code>：返回键名的遍历器</li> <li><code>Set.prototype.values()</code>：返回键值的遍历器</li> <li><code>Set.prototype.entries()</code>：返回键值对的遍历器</li> <li><code>Set.prototype.forEach()</code>：使用回调函数遍历每个成员</li></ul> <p>需要特别指出的是，<code>Set</code>的<strong>遍历顺序就是插入顺序</strong>。这个特性可用来保存一个回调函数列表，调用时就能保证按照添加顺序调用<br>
（1） <code>keys()</code>，<code>values()</code>，<code>entries()</code><br> <code>keys</code>方法、<code>values</code>方法、<code>entries</code> 方法返回的都是遍历器对象。而由于 <code>Set</code> 结构没有键名，只有键值（或者说键名和键值是同一个值），所以 <code>keys</code> 方法和 <code>values</code> 方法的行为完全一致:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> <span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// red</span>
<span class="token comment">// green</span>
<span class="token comment">// blue</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> <span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// red</span>
<span class="token comment">// green</span>
<span class="token comment">// blue</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> <span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// [&quot;red&quot;, &quot;red&quot;]</span>
<span class="token comment">// [&quot;green&quot;, &quot;green&quot;]</span>
<span class="token comment">// [&quot;blue&quot;, &quot;blue&quot;]</span>
</code></pre></div><p>上面代码中，<code>entries</code> 方法返回的<strong>遍历器</strong>，同时包括<strong>键名</strong>和<strong>键值</strong>，所以每次输出一个数组，它的两个成员完全相等<br>
（2）<code>forEach()</code> <code>Set</code> 结构的实例与数组一样，也拥有 <code>forEach</code> 方法，用于对每个成员执行某种操作，没有返回值:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">' : '</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 1 : 1</span>
<span class="token comment">// 4 : 4</span>
<span class="token comment">// 9 : 9</span>
</code></pre></div><p>上面代码说明，<code>forEach</code> 方法的参数就是一个处理函数。该函数的参数与数组的 <code>forEach</code> 一致，依次为键值、键名。这里需要注意，<code>Set</code> 结构的<strong>键名就是键值</strong>（两者是同一个值），因此第一个参数与第二个参数的值永远都是一样的</p> <h2 id="weakset"><a href="#weakset" aria-hidden="true" class="header-anchor">#</a> WeakSet</h2> <p><code>WeakSet</code> 结构与 <code>Set</code> 类似，也是不重复的值的集合。但是，它与 <code>Set</code> 有两个区别:</p> <ul><li><code>WeakSet</code> 的成员只能是对象，而不能是其他类型的值</li> <li><code>WeakSet</code> 中的对象都是<strong>弱引用</strong>，即垃圾回收机制不考虑 <code>WeakSet</code> 对该对象的引用</li></ul> <p>先说前者:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">// TypeError: Invalid value used in weak set</span>
ws<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// TypeError: invalid value used in weak set</span>
</code></pre></div><p>上面代码试图向 <code>WeakSet</code> 添加一个数值和 <code>Symbol</code> 值，结果报错，因为 <code>WeakSet</code> 只能放置对象</p> <p>关于第二点，<code>WeakSet</code> 中的对象都是弱引用，即<strong>垃圾回收</strong>机制不考虑 <code>WeakSet</code> 对该对象的引用，也就是说，如果其他对象都不再引用该对象，那么垃圾回收机制会自动回收该对象所占用的内存，不考虑该对象还存在于 <code>WeakSet</code> 之中<br>
由于上面这个特点，<code>WeakSet</code> 的成员是不适合引用的，因为它会随时消失。另外，由于 <code>WeakSet</code> 内部有多少个成员，取决于垃圾回收机制有没有运行，运行前后很可能成员个数是不一样的，而垃圾回收机制何时运行是不可预测的，因此 <code>ES6</code> 规定 <code>WeakSet</code> <strong>不可遍历</strong></p> <h3 id="weakset基本语法"><a href="#weakset基本语法" aria-hidden="true" class="header-anchor">#</a> WeakSet基本语法</h3> <p><code>WeakSet</code> 是一个构造函数，可以使用 <code>new</code> 命令，创建 <code>WeakSet</code> 数据结构</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>作为构造函数，<code>WeakSet</code> 可以接受一个数组或类似数组的对象作为参数。（实际上，任何具有 <code>Iterable</code> 接口的对象，都可以作为 <code>WeakSet</code> 的参数。）该数组的所有成员，都会自动成为 <code>WeakSet</code> 实例对象的成员</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// WeakSet {[1, 2], [3, 4]}</span>
</code></pre></div><p>上面代码中，<code>a</code> 是一个数组，它有两个成员，也都是数组。将 <code>a</code> 作为 <code>WeakSet</code> 构造函数的参数，<code>a</code> 的成员会自动成为 <code>WeakSet</code> 的成员
注意，是 <code>a</code> 数组的成员成为 <code>WeakSet</code> 的成员，而不是 <code>a</code> 数组本身。这意味着，<strong>数组的成员只能是对象</strong>，如果是其他基本数据类型则会报错，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Uncaught TypeError: Invalid value used in weak set(…)</span>
</code></pre></div><h3 id="weakset方法"><a href="#weakset方法" aria-hidden="true" class="header-anchor">#</a> WeakSet方法</h3> <p><code>WeakSet</code> 结构有以下三个方法:</p> <ul><li><code>WeakSet.prototype.add(value)</code>：向 <code>WeakSet</code> 实例添加一个新成员</li> <li><code>WeakSet.prototype.delete(value)</code>：清除 <code>WeakSet</code> 实例的指定成员</li> <li><code>WeakSet.prototype.has(value)</code>：返回一个布尔值，表示某个值是否在 <code>WeakSet</code> 实例之中</li></ul> <p>以下是一些使用的注意点:
<code>WeakSet</code> 没有 <code>size</code> 属性，没有办法遍历它的成员</p> <div class="language-js extra-class"><pre class="language-js"><code>ws<span class="token punctuation">.</span>size <span class="token comment">// undefined</span>
ws<span class="token punctuation">.</span>forEach <span class="token comment">// undefined</span>

ws<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WeakSet has '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// TypeError: undefined is not a function</span>
</code></pre></div><p><code>WeakSet</code> 不能遍历，是因为成员都是弱引用，随时可能消失，遍历机制无法保证成员的存在，很可能刚刚遍历结束，成员就取不到了。不过我们可以用来储存 <code>DOM</code> 节点，此时就不需要担心这些节点从文档移除的情况</p> <h2 id="小结"><a href="#小结" aria-hidden="true" class="header-anchor">#</a> 小结</h2> <ul><li>对于 <code>Set</code> 可以想象成一个<strong>键</strong>和<strong>值</strong>完全相等的特殊对象，由于对象上的属性是独一无二的，所以 <code>Set</code> 内部的成员亦是独一无二的</li> <li>对于 <code>WeakSet</code> 是成员只能为对象的特殊 <code>Set</code>，同时由于 <code>WeakSet</code> 中对象都是弱引用，因此在垃圾回收时很可能消失，因此 <code>WeakSet</code> 是不可以遍历的</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于：: </span> <span class="time">9/13/2019, 4:59:36 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/reading/es6/async.html" class="prev">
          async函数
        </a></span> <span class="next"><a href="/reading/es6/map-weakmap.html">
          Map 与 WeakMap数据结构
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2a0bc12.js" defer></script><script src="/assets/js/2.ffc85a67.js" defer></script><script src="/assets/js/26.08fc6653.js" defer></script>
  </body>
</html>
